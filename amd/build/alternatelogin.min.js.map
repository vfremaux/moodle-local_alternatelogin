{"version":3,"file":"alternatelogin.min.js","sources":["../src/alternatelogin.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// jshint undef:false, unused:false, scripturl:true\n\n/**\n * Javascript controller for controlling the sections.\n *\n * @module     local_advancedperfs/perfs_panel\n * @package    local_advancedperfs\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/config', 'core/log'], function($, cfg, log) {\n\n    var alternatelogin = {\n\n        init: function() {\n            $('.alternate-profile-choice').bind('click', this.togglechoice);\n            $('#back-step-1').bind('click', this.switchtopanel1);\n            $('#next-step-2').bind('click', this.switchtopanel2);\n            $('#next-step-3').bind('click', this.send);\n            $('.field-cpy-check input').bind('keyup', this.checkfieldcopy);\n            $('input.field-non-empty-input').bind('keyup', this.checknonempty);\n            $('select.field-non-empty-input').bind('change', this.checknonempty);\n            $('#id-field-authcode-input').bind('change', this.checkauthcode);\n\n            $('.field-cpy-check input').trigger('keyup');\n            $('input.field-non-empty-input').trigger('keyup');\n            $('select.field-non-empty-input').trigger('change');\n            $('#readmore').trigger('open');\n\n            // Profile field choices cannot be checked by trigger.\n            alternatelogin.updatebutton3state();\n\n            log.debug('AMD alternate login initialized');\n        },\n\n        togglechoice: function() {\n            var that = $(this);\n\n            var matches = that.attr('id').match(/pv-choice-btn-(\\d+)-(\\d+)/);\n            var thatid = matches[1];\n            $('.alternate-profile-choice').removeClass('selected');\n            $('.alternate-profile-field').val('');\n            that.addClass('selected');\n            $('#pv-' + thatid).val(that.attr('data-value'));\n            $('#pv-' + thatid).removeClass('unchecked');\n\n            alternatelogin.updatebutton3state();\n        },\n\n        checknonempty: function() {\n            var that = $(this);\n            if (that.val() !== '') {\n                that.removeClass('unchecked');\n            } else {\n                that.addClass('unchecked');\n            }\n            alternatelogin.updatebutton2state();\n            alternatelogin.updatebutton3state();\n        },\n\n        checkauthcode: function() {\n\n            var that = $(this);\n\n            var url = cfg.wwwroot + '/local/alternatelogin/ajax/service.php';\n            url += '?what=checkcode';\n            url += '&code=' + that.val();\n\n            $.get(url, function(data) {\n                if (data.result === 1) {\n                    $('#id-field-authcode-field').removeClass('error');\n                } else {\n                    $('#id-field-authcode-field').addClass('error');\n                }\n            }, 'json');\n        },\n\n        switchtopanel2: function() {\n            $('#sign-up-panel-1').addClass('hidden');\n            $('#sign-up-panel-2').removeClass('hidden');\n        },\n\n        switchtopanel1: function() {\n            $('#sign-up-panel-1').removeClass('hidden');\n            $('#sign-up-panel-2').addClass('hidden');\n        },\n\n        send: function() {\n            $('form[name=signup-form]').submit();\n        },\n\n        checkfieldcopy: function() {\n            var that = $(this);\n\n            var baseelmname = that.attr('name').replace('confirm', '');\n            var confirmelmname = baseelmname + 'confirm';\n            var val1 = $('input[name=' + baseelmname + ']').val();\n            var val2 = $('input[name=' + confirmelmname + ']').val();\n\n            var src = $('#' + baseelmname + '-field-cpy-check img').attr('src');\n            if ((val1 === val2) && (val1 !== '')) {\n                $('.' + baseelmname + '-field-cpy-check img').attr('src', src.replace(/\\bnook$/, 'ok'));\n                $('.' + baseelmname + '-field-cpy-check img').attr('src', src.replace(/\\bnook$/, 'ok'));\n                $('.' + baseelmname + '-field-cpy-check').removeClass('unchecked');\n            } else {\n                $('.' + baseelmname + '-field-cpy-check img').attr('src', src.replace(/\\bok$/, '/nook'));\n                $('.' + baseelmname + '-field-cpy-check img').attr('src', src.replace(/\\bok$/, '=nook'));\n                $('.' + baseelmname + '-field-cpy-check').addClass('unchecked');\n            }\n            alternatelogin.updatebutton2state();\n        },\n\n        updatebutton2state: function() {\n            if ($('#sign-up-panel-1 .unchecked').length === 0) {\n                $('#next-step-2').prop('disabled', false);\n            } else {\n                $('#next-step-2').prop('disabled', true);\n            }\n        },\n\n        updatebutton3state: function() {\n            if ($('#sign-up-panel-2 .unchecked').length === 0) {\n                $('#next-step-3').prop('disabled', false);\n            } else {\n                $('#next-step-3').prop('disabled', true);\n            }\n        }\n    };\n\n    return alternatelogin;\n});"],"names":["define","$","cfg","log","alternatelogin","init","bind","this","togglechoice","switchtopanel1","switchtopanel2","send","checkfieldcopy","checknonempty","checkauthcode","trigger","updatebutton3state","debug","that","thatid","attr","match","removeClass","val","addClass","updatebutton2state","url","wwwroot","get","data","result","submit","baseelmname","replace","confirmelmname","val1","val2","src","length","prop"],"mappings":"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"}